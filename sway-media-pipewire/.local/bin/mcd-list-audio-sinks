#!/usr/bin/env bash

STATUS_MISSING_DEPENDENCY=1

if ! command -v pw-dump >/dev/null 2>&1; then
    echo "pipewire util is required"
    exit $STATUS_MISSING_DEPENDENCY
fi

if ! command -v jq >/dev/null 2>&1; then
    echo "jq util is required"
    exit $STATUS_MISSING_DEPENDENCY
fi

pw-dump \
    | jq '[ .[] | select(.info.props["media.class"] == "Audio/Sink") ]' \
    | jq '[ .[] | {id, nick: .info.props["node.nick"], desc: .info.props["node.description"], icon: .info.props["device.icon-name"] } ]'
