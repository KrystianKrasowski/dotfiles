#!/usr/bin/env bash
echo '{"version":1, "click_events":true}'
echo '['
echo '[],'

exec 3<&0

handle_clicks() {
    while read -r line <&3; do
        if echo "$line" | grep -q '"name": "lock"'; then
            gtklock &
        fi
    done
}

handle_clicks &

battery() {
    local battery="/sys/class/power_supply/BAT0"
    local battery_capacity=$(cat $battery/capacity)
    local battery_state=$(cat $battery/status)

    if [ "$battery_state" = "Discharging" ]; then
        echo -n "{\"full_text\":\"\"}"
}

while :; do
    datetime=$(date '+%d %b %H:%M')

    echo -n '['
    echo -n "{\"full_text\":\"$datetime\"}"
    echo -n ',{"full_text":"ï€£", "name":"lock"}'
    echo '],'
    sleep 1
done
